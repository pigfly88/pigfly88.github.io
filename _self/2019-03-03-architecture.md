---
layout: post
category: "工具"
title:  "架构"
---

## 什么是架构
软件架构指软件系统的顶层结构，**架构设计的主要目的是为了解决软件系统复杂度带来的问题。**

## 复杂度来源

### 高性能

- 单机

    计算机内部复杂度最关键的地方就是操作系统，操作系统和性能最相关的就是进程和线程。操作系统发展到现在，如果我们要完成一个高性能的软件系统，需要考虑如多进程、多线程、进程间通信、多线程并发等。

- 集群
    - 任务分配
        ![集群](/images/cluster.png)

        服务器从一台变成两台，需要增加一个任务分配器，这个分配器可能是硬件网络设备（F5、交换机等），可能是软件网络设备（LVS），也可能是负载均衡软件（Nginx、HAProxy）。

        任务分配器和真正的业务服务器之间有连接和交互（即图中任务分配器到业务服务器的连接线），需要选择合适的连接方式，并且对连接进行管理。例如，连接建立、连接检测、连接中断后如何处理等。

        任务分配器需要增加分配算法。例如，是采用轮询算法，还是按权重分配，又或者按照负载进行分配。

        假设任务分配器也面临瓶颈，也需要扩展为多台机器，架构是这样的：
        ![集群-2](/images/cluster-2.png)
        用户分配常见的方法包括 DNS 轮询、智能 DNS、CDN（Content Delivery Network，内容分发网络）、GSLB 设备（Global Server Load Balance，全局负载均衡）等。

    - 任务分解
        当业务越来越复杂，单台的效率还是很低，即使通过任务分配的方式作用也不大，为了继续提升性能，需要做任务分解。
        ![集群-3](/images/cluster-3.png)

### 高可用

高可用的意思就是无中断地对外提供服务。单台机器肯定是达不到的，要实现高可用，手段跟高性能一样，也是通过增加机器来达到目的。
- 计算高可用

    这里的“计算”指的是业务的逻辑处理。计算有一个特点就是无论在哪台机器上进行计算，同样的算法和输入数据，产出的结果都是一样的。复杂度跟高性能类似，任务分配器的分配算法有所不同。例如，常见的双机算法有主备、主主，主备方案又可以细分为冷备、温备、热备。

- 存储高可用

    需要注意同步数据有延迟带来的问题。

### 可扩展
可扩展性指系统为了应对将来需求变化而提供的一种扩展能力，当有新的需求出现时，系统不需要或者仅需要少量修改就可以支持，无须整个系统重构或者重建。

第一种应对变化的常见方案是将“变化”封装在一个“变化层”，将不变的部分封装在一个独立的“稳定层”。

## 架构设计的三原则
- 合适原则
- 简单原则
- 演化原则